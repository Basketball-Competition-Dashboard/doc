openapi: 3.0.0

info:
  title: 籃球情報室 Web API 文件
  version: 0.1.0
  description: Basketball Competition Dashboard Web API

externalDocs:
  description: Home Page
  url: https://github.com/Basketball-Competition-Dashboard

servers:
  - url: '{ORIGIN}/api/web'
    description: Web API service root
    variables:
      ORIGIN:
        default: http://127.0.0.1:5000
        description: The origin of the service

tags:
  - name: 測試
    description: Testing
  - name: 認證
    description: Authentication
  - name: 比賽
    description: Games
  - name: 球隊
    description: Teams
  - name: 球員
    description: Players

paths:
  /ping:
    get:
      tags:
        - 測試
      summary: 測試
      description: Ping Pong!
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: string
                enum:
                  - Pong!
                example: 'Pong!'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/login:
    post:
      tags:
        - 認證
      summary: 登入
      description: Login
      requestBody:
        description: The request body for authentication
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Auth'
            examples:
              'Demo Jack':
                value:
                  name: 'Demo Manager Jack'
                  credential: 'Pa55w0rd'
              'Demo Zoe':
                value:
                  name: 'Demo Manager Zoe'
                  credential: 'A super safe password!'
      responses:
        '201':
          description: Logged in
          headers:
            Set-Cookie:
              schema:
                type: string
                example: >-
                  session_id=MTRlNGIzYzI0MTk3NGIzYjg3ODI2MjlhNWY1ZWRhNmE=;
                  HttpOnly; Max-Age=31536000; Path=/; SameSite=Strict
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  
  /auth/logout:
    post:
      tags:
        - 認證
      summary: 登出
      description: Logout
      security:
        - SessionID: []
      responses:
        '204':
          description: Logged out
          headers:
            Set-Cookie:
              schema:
                type: string
                example: 'session_id=; HttpOnly; Max-Age=0; Path=/; SameSite=Strict'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /games:
    get:
      tags:
        - 比賽
      summary: 取得比賽資料
      description: Get games
      parameters:
        - $ref: '#/components/parameters/page_offset'
        - $ref: '#/components/parameters/page_length'
        - $ref: '#/components/parameters/sort_field'
        - $ref: '#/components/parameters/sort_order'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                description: Games
                type: array
                items:
                  $ref: '#/components/schemas/Game'
              examples:
                'three games':
                  value:
                    - id: 3001
                      away_id: 60019
                      away_abbr: 'BOS'
                      home_id: 60020
                      home_abbr: 'MIL'
                      away_name: 'Celtics'
                      home_name: 'Bucks'
                      date: '2024-05-06'
                      away_score: 3
                      home_score: 0
                    - id: 3002
                      away_id: 60020
                      away_abbr: 'MIL'
                      home_id: 60021
                      home_abbr: 'IND'
                      away_name: 'Bucks'
                      home_name: 'Pacers'
                      date: '2024-05-07'
                      away_score: 2
                      home_score: 1
                    - id: 3003
                      away_id: 60021
                      away_abbr: 'IND'
                      home_id: 60019
                      home_abbr: 'BOS'
                      away_name: 'Pacers'
                      home_name: 'Celtics'
                      date: '2024-05-08'
                      away_score: 1
                      home_score: 2
                'no game':
                  value: []
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /game:
    post:
      tags:
        - 比賽
      summary: 新增比賽資料
      description: Create a game
      security:
        - SessionID: []
      requestBody:
        description: The request body for creating a game
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameNew'
            examples:
              'A request of creating a game':
                value:
                  away_name: 'Pacers'
                  home_name: 'Bucks'
                  date: '2024-05-09'
                  away_score: 3
                  home_score: 0
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                description: The new game
                $ref: '#/components/schemas/Game'
              examples:
                'A response of creating a game':
                  value:
                    id: 3004
                    away_id: 60021
                    away_abbr: 'IND'
                    home_id: 60020
                    home_abbr: 'MIL'
                    away_name: 'Pacers'
                    home_name: 'Bucks'
                    date: '2024-05-09'
                    away_score: 3
                    home_score: 0
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /game/{id}:
    patch:
      tags:
        - 比賽
      summary: 更新比賽資料
      description: Update a game
      security:
        - SessionID: []
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        description: The request body for updating a game
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GamePatch'
            examples:
              'A request of updating a game':
                value:
                  date: '2024-05-09'
                  is_home_winner: false
                  away_score: 30
                  home_score: 20
      responses:
        '204':
          description: Updated
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /teams:
    get:
      tags:
        - 球隊
      summary: 取得球隊資料
      description: Get teams
      parameters:
        - $ref: '#/components/parameters/page_offset'
        - $ref: '#/components/parameters/page_length'
        - $ref: '#/components/parameters/sort_field'
        - $ref: '#/components/parameters/sort_order'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                description: Teams
                type: array
                items:
                  $ref: '#/components/schemas/Team'
              examples:
                'three teams':
                  value:
                    - id: 60019
                      abbr: 'BOS'
                      name: 'Celtics'
                      city: 'Boston'
                      year_founded: 1946
                      coach: 'Joseph Mazzulla'
                    - id: 60020
                      abbr: 'MIL'
                      name: 'Bucks'
                      city: 'Milwaukee'
                      year_founded: 1968
                      coach: 'Vin Baker'
                    - id: 60021
                      abbr: 'IND'
                      name: 'Pacers'
                      city: 'Indiana'
                      year_founded: 1967
                      coach: 'Dane Fife'
                'no team':
                  value: []
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /team:
    post:
      tags:
        - 球隊
      summary: 新增球隊資料
      description: Create a team
      security:
        - SessionID: []
      requestBody:
        description: The request body for creating a team
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamNew'
            examples:
              'A request of creating a team':
                value:
                  abbr: 'BOS'
                  name: 'Celtics'
                  city: 'Boston'
                  year_founded: 1946
                  coach: 'John Russell'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                description: The new team
                $ref: '#/components/schemas/Team'
              examples:
                'A response of creating a team':
                  value:
                    id: 60022
                    abbr: 'BOS'
                    name: 'Celtics'
                    city: 'Boston'
                    year_founded: 1946
                    coach: 'John Russell'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /team/{id}:
    patch:
      tags:
        - 球隊
      summary: 更新球隊資料
      description: Update a team
      security:
        - SessionID: []
      parameters:
        - $ref: '#/components/parameters/id'
      requestBody:
        description: The request body for updating a team
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamPatch'
            examples:
              'A request of updating a team':
                value:
                  coach: 'Joseph Mazzulla'
      responses:
        '204':
          description: Updated
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /player-profiles:
    post:
      tags:
        - 球員
      summary: 取得球員介紹資料
      description: Get player profile data set
      requestBody:
        $ref: '#/components/requestBodies/Pagination'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                description: Player profile data set with ID
                type: array
                items:
                  description: Player profile data with ID
                  allOf:
                    - $ref: '#/components/schemas/WithID'
                    - $ref: '#/components/schemas/PlayerProfile'
              examples:
                'two player profiles':
                  value:
                    - id: 3695
                      name: 'Precious Achiuwa'
                      team_name: 'Knicks'
                      position: 'F'
                      birthdate: '1970-05-25'
                      height: '6-8'
                      weight: 243
                      country: 'Nigeria'
                    - id: 3696
                      name: 'Steven Adams'
                      team_name: 'Grizzlies'
                      position: 'C'
                      birthdate: '1970-05-25'
                      height: '6-8'
                      weight: 265
                      country: 'New Zealand'
                'no player profile':
                  value: []
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - 球員
      summary: 新增或更新球員介紹資料
      description: Create or update player profile data set
      security:
        - SessionID: []
      requestBody:
        description: The request body for player profile data modifications
        required: true
        content:
          application/json:
            schema:
              description: |
                Player profile data set.

                If the `id` field presents, the server will update the player profile data with the same ID.
                Otherwise, the server will create a new player profile data.
              type: array
              items:
                description: Player profile data to create or update
                oneOf:
                  - $ref: '#/components/schemas/PlayerProfile'
                  - allOf:
                    - $ref: '#/components/schemas/WithID'
                    - $ref: '#/components/schemas/PlayerProfile'
            examples:
              'Create a player profile':
                value:
                  - name: 'Precious Achiuwa'
                    team_name: 'Knicks'
                    position: 'F'
                    birthdate: '1970-05-25'
                    height: '6-8'
                    weight: 243
                    country: 'Nigeria'
              'Update a player profile':
                value:
                  - id: 3695
                    name: 'Precious Achiuwa'
                    team_name: 'Knicks'
                    position: 'F'
                    birthdate: '1970-05-25'
                    height: '6-8'
                    weight: 244
                    country: 'Nigeria'
      responses:
        '201':
          description: Created
        '204':
          description: Updated
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /player-profiles/{id}:
    delete:
      tags:
        - 球員
      summary: 刪除球員介紹資料
      description: Delete player profile data
      security:
        - SessionID: []
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '204':
          description: Deleted
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /player-stats:
    post:
      tags:
        - 球員
      summary: 取得球員表現資料
      description: Get player statistics data set
      requestBody:
        $ref: '#/components/requestBodies/Pagination'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                description: Player statistics data set with ID
                type: array
                items:
                  description: Player statistics data with ID
                  allOf:
                    - $ref: '#/components/schemas/WithID'
                    - type: object
                      properties:
                        game:
                          $ref: '#/components/schemas/WithID'
                    - $ref: '#/components/schemas/PlayerStatHeader'
                    - $ref: '#/components/schemas/PlayerStatMain'
              examples:
                'two player stats':
                  value:
                    - id: 3695
                      name: 'Precious Achiuwa'
                      game:
                        id: 240506
                        date: '2024-05-06'
                        home_name: 'Celtics'
                        away_name: 'Nets'
                      assist: 20
                      hit: 5
                      steal: 6
                      rebound: 25
                      free_throw: 2
                      score: 23
                    - id: 3696
                      name: 'Steven Adams'
                      game_name: '240502 HOU MEM'
                      assist: 20
                      hit: 6
                      steal: 6
                      rebound: 25
                      free_throw: 5
                      score: 23
                'no player stat':
                  value: []
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
        - 球員
      summary: 新增或更新球員表現資料
      description: Create or update player statistics data set
      security:
        - SessionID: []
      requestBody:
        description: The request body for player statistics data modifications
        required: true
        content:
          application/json:
            schema:
              description: |
                Player statistics data set.

                If the `id` field presents, the server will update the player statistics data with the same ID.
                Otherwise, the server will create a new player statistics data.
              type: array
              items:
                description: Player statistics data to create or update
                oneOf:
                  - allOf:
                    - $ref: '#/components/schemas/PlayerStatHeader'
                    - $ref: '#/components/schemas/PlayerStatMain'
                  - allOf:
                    - $ref: '#/components/schemas/WithID'
                    - type: object
                      properties:
                        game:
                          $ref: '#/components/schemas/WithID'
                    - $ref: '#/components/schemas/PlayerStatMain'
            examples:
              'Create a player statistics':
                value:
                  - name: 'Precious Achiuwa'
                    game_name: '240506 HOU MEM'
                    assist: 20
                    hit: 5
                    steal: 6
                    rebound: 25
                    free_throw: 2
                    score: 23
              'Update two player statistics':
                value:
                  - id: 3695
                    assist: 20
                    hit: 5
                    steal: 6
                    rebound: 25
                    free_throw: 3
                    score: 24
                  - id: 3696
                    assist: 20
                    hit: 6
                    steal: 6
                    rebound: 25
                    free_throw: 5
                    score: 23
      responses:
        '201':
          description: Created
        '204':
          description: Updated
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /player-stats/{id}:
    delete:
      tags:
        - 球員
      summary: 刪除球員表現資料
      description: Delete player statistics data
      security:
        - SessionID: []
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '204':
          description: Deleted
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    id:
      description: Resource ID
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: uint32
        example: 0
    page_offset:
      description: The offset of paginated data
      name: page_offset
      in: query
      required: true
      schema:
        type: integer
        format: uint32
        example: 0
    page_length:
      description: The length of paginated data
      name: page_length
      in: query
      required: true
      schema:
        type: integer
        format: uint32
        example: 3
    sort_field:
      description: Field to sort by
      name: sort_field
      in: query
      required: true
      schema:
        type: string
        example: 'name'
    sort_order:
      description: Sort order
      name: sort_order
      in: query
      required: true
      schema:
        type: string
        enum:
          - 'ascending'
          - 'descending'
        example: 'descending'

  schemas:
    Auth:
      description: Authentication data
      type: object
      required:
        - name
        - credential
      properties:
        name:
          type: string
          example: 'Manager Zoe'
        credential:
          type: string
          format: password
          example: 'A super safe password!'

    WithID:
      description: Resource with ID
      type: object
      required:
        - id
      properties:
        id:
          description: Resource ID
          type: integer
          format: uint32
          example: 0

    Game:
      description: A game
      allOf:
        - type: object
          required:
            - id
            - away_id
            - away_abbr
            - home_id
            - home_abbr
          properties:
            id:
              description: The ID of the game
              type: integer
              format: uint32
            away_id:
              description: The ID of the away team
              type: integer
              format: uint32
            away_abbr:
              description: The abbreviation of the away team
              type: string
            home_id:
              description: The ID of the home team
              type: integer
              format: uint32
            home_abbr:
              description: The abbreviation of the home team
              type: string
        - $ref: '#/components/schemas/GameNew'

    GameNew:
      description: A new game
      allOf:
        - type: object
          required:
            - away_name
            - home_name
            - date
          properties:
            away_name:
              description: The name of the away team
              type: string
            home_name:
              description: The name of the home team
              type: string
        - $ref: '#/components/schemas/GamePatch'

    GamePatch:
      description: A patch for the game
      type: object
      properties:
        date:
          description: The date of the game
          type: string
          format: date
        is_home_winner:
          description: Is the home team the winner
          type: boolean
        away_score:
          description: The score of the away team
          type: integer
          format: uint32
        home_score:
          description: The score of the home team
          type: integer
          format: uint32

    Team:
      description: A team
      allOf:
        - type: object
          required:
            - id
          properties:
            id:
              description: The ID of the team
              type: integer
              format: uint32
        - $ref: '#/components/schemas/TeamNew'

    TeamNew:
      description: A new team
      allOf:
        - type: object
          required:
            - abbr
            - name
            - city
            - year_founded
          properties:
            abbr:
              description: The abbreviation of the team
              type: string
              example: 'BOS'
            name:
              description: The name of the team
              type: string
              example: 'Celtics'
            city:
              description: The city of the team
              type: string
              example: 'Boston'
            year_founded:
              description: The year the team was founded
              type: integer
              format: uint32
              example: 1946
        - $ref: '#/components/schemas/TeamPatch'

    TeamPatch:
      description: A patch for the team
      type: object
      properties:
        coach:
          description: The coach of the team
          type: string
          example: 'Joseph Mazzulla'

    PlayerProfile:
      description: Player profile data
      type: object
      required:
        - name
      properties:
        name:
          description: Player name
          type: string
          example: 'Precious Achiuwa'
        team_name:
          description: Team name
          type: string
          example: 'Knicks'
        position:
          description: Player position
          type: string
          example: 'F'
        birthdate:
          description: Player birthdate
          type: string
          format: date
          example: '1970-05-25'
        height:
          description: Player height
          type: string
          example: '6-8'
        weight:
          description: Player weight
          type: integer
          format: uint32
          example: 243
        country:
          description: Player country
          type: string
          example: 'Nigeria'
    
    PlayerStatHeader:
      description: Player statistics header data
      type: object
      required:
        - name
        - game
      properties:
        name:
          description: Player name
          type: string
          example: 'Precious Achiuwa'

    PlayerStatMain:
      description: Player statistics main data
      type: object
      properties:
        assist:
          description: Player assist count
          type: integer
          format: uint32
          example: 20
        hit:
          description: Player hit count
          type: integer
          format: uint32
          example: 5
        steal:
          description: Player steal count
          type: integer
          format: uint32
          example: 6
        rebound:
          description: Player rebound count
          type: integer
          format: uint32
          example: 25
        free_throw:
          description: Player free throw count
          type: integer
          format: uint32
          example: 3
        score:
          description: Player score count
          type: integer
          format: uint32
          example: 24

    PageOptions:
      description: Page options
      type: object
      required:
        - offset
        - length
      properties:
        offset:
          description: The offset of paginated data
          type: integer
          format: uint32
          example: 0
        length:
          description: The length of paginated data
          type: integer
          format: uint32
          example: 10

    SortOptions:
      description: Sort options
      type: object
      required:
        - field
        - order
      properties:
        field:
          description: Field to sort by
          type: string
          example: 'name'
        order:
          description: Sort order
          type: string
          enum:
            - 'ascending'
            - 'descending'
          example: 'descending'

    Error:
      description: Reason for error
      type: object
      required:
        - message
      properties:
        message:
          type: string
          example: 'An unexpected error has occurred.'

  requestBodies:
    Pagination:
      description: The request body for paginated data
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - page
              - sort
            properties:
              page:
                $ref: '#/components/schemas/PageOptions'
              sort:
                $ref: '#/components/schemas/SortOptions'
          examples:
            'ten records sorted by name in ascending order':
              value:
                page:
                  offset: 0
                  length: 10
                sort:
                  field: 'name'
                  order: 'ascending'
            'five records sorted by date in descending order':
              value:
                page:
                  offset: 5
                  length: 5
                sort:
                  field: 'date'
                  order: 'descending'

  responses:
    BadRequestError:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: 'Your request is invalid.'

    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: 'You are not authorized to access this resource.'

    NotFoundError:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: 'The resource you are accessing is not found.'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: 'Sorry, an unexpected error has occurred.'

  securitySchemes:
    SessionID:
      description: The cookie for authorization, which is managed by the server.
      name: session_id
      in: cookie
      type: apiKey
